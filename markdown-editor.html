<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdownå®æ—¶ç¼–è¾‘å™¨</title>
    <!-- å¼•å…¥marked.jsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Markdownç¼–è¾‘å™¨ä¸“ç”¨æ ·å¼ */
        .markdown-editor {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .editor-header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .editor-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 300;
        }

        .editor-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .editor-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .panel-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .panel-header .btn {
            padding: 6px 12px;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        .fullscreen-btn {
            background: #27ae60;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fullscreen-btn:hover {
            background: #219a52;
            transform: translateY(-1px);
        }

        .exit-fullscreen-btn {
            background: #e74c3c;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .exit-fullscreen-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .panel-header h3 {
            margin: 0;
            color: #495057;
            font-size: 1.2rem;
        }

        .panel-content {
            padding: 0;
            height: 400px;
            overflow: auto;
        }

        #markdown-input {
            width: 100%;
            height: 100%;
            border: none;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            background: #fafafa;
        }

        #preview-content {
            padding: 20px;
            line-height: 1.8;
        }

        /* Markdowné¢„è§ˆæ ·å¼ */
        #preview-content h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
        }

        #preview-content h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }

        #preview-content h3 {
            color: #7f8c8d;
        }

        #preview-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        #preview-content pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }

        #preview-content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        #preview-content blockquote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 20px 0;
            color: #7f8c8d;
            font-style: italic;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 0 5px 5px 0;
        }

        #preview-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }

        #preview-content table th,
        #preview-content table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }

        #preview-content table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .status {
            text-align: center;
            margin-top: 10px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .error {
            color: #e74c3c;
            background: #fadbd8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        /* å…¨å±æ¨¡å¼æ ·å¼ */
        .fullscreen-mode .editor-header,
        .fullscreen-mode .editor-container .editor-panel:first-child,
        .fullscreen-mode .controls {
            display: none !important;
        }

        .fullscreen-mode .editor-container {
            grid-template-columns: 1fr !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .fullscreen-mode .editor-panel {
            height: 100vh !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
        }

        .fullscreen-mode .panel-content {
            height: calc(100vh - 60px) !important;
            max-height: none !important;
        }

        .fullscreen-mode #preview-content {
            padding: 40px !important;
            font-size: 1.1em !important;
            line-height: 1.8 !important;
            max-width: 1200px !important;
            margin: 0 auto !important;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .editor-header h1 {
                font-size: 2rem;
            }
            
            .panel-content {
                height: 300px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }

            .fullscreen-mode #preview-content {
                padding: 20px !important;
                font-size: 1em !important;
            }
        }

        @media (max-width: 480px) {
            .markdown-editor {
                padding: 10px;
            }
            
            .editor-header {
                padding: 20px;
            }
            
            .panel-content {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <h1 class="logo">æˆ‘çš„åšå®¢</h1>
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                    <li><a href="article/index.html" class="nav-link">æ–‡ç« </a></li>
                    <li><a href="file/index.html" class="nav-link">èµ„æº</a></li>
                    <li><a href="markdown-editor.html" class="nav-link active">Markdownç¼–è¾‘å™¨</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="markdown-editor">
        <!-- ç¼–è¾‘å™¨å¤´éƒ¨ -->
        <div class="editor-header">
            <h1>ğŸ“ Markdownå®æ—¶ç¼–è¾‘å™¨</h1>
            <p>åœ¨å·¦ä¾§è¾“å…¥Markdownæ–‡æœ¬ï¼Œå³ä¾§å®æ—¶é¢„è§ˆæ¸²æŸ“æ•ˆæœ</p>
        </div>

        <!-- é”™è¯¯æç¤ºåŒºåŸŸ -->
        <div id="error-message" class="error"></div>

        <!-- ç¼–è¾‘å™¨ä¸»ä½“ -->
        <div class="editor-container">
            <!-- è¾“å…¥é¢æ¿ -->
            <div class="editor-panel">
                <div class="panel-header">
                    <h3>ğŸ“‹ Markdownè¾“å…¥</h3>
                    <span class="char-count">å­—ç¬¦æ•°: <span id="char-count">0</span></span>
                </div>
                <div class="panel-content">
                    <textarea 
                        id="markdown-input" 
                        placeholder="åœ¨è¿™é‡Œè¾“å…¥Markdownæ–‡æœ¬...

ç¤ºä¾‹ï¼š
# æ ‡é¢˜ä¸€
## æ ‡é¢˜äºŒ
- åˆ—è¡¨é¡¹1
- åˆ—è¡¨é¡¹2

**ç²—ä½“æ–‡æœ¬** *æ–œä½“æ–‡æœ¬*

[é“¾æ¥æ–‡æœ¬](https://example.com)

```javascript
// ä»£ç å—
console.log('Hello World!');
```">
                    </textarea>
                </div>
            </div>

            <!-- é¢„è§ˆé¢æ¿ -->
            <div class="editor-panel">
                <div class="panel-header">
                    <h3>ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</h3>
                    <div class="controls">
                        <span class="auto-update">è‡ªåŠ¨æ›´æ–°: <span id="auto-update-status">å¼€å¯</span></span>
                        <button id="fullscreen-btn" class="btn fullscreen-btn">ğŸ“º å…¨å±é¢„è§ˆ</button>
                        <button id="exit-fullscreen-btn" class="btn exit-fullscreen-btn" style="display: none;">âŒ é€€å‡ºå…¨å±</button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="preview-content">
                        <p style="color: #999; text-align: center; margin-top: 50%;">
                            é¢„è§ˆå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button id="convert-btn" class="btn btn-primary">ğŸ”„ æ‰‹åŠ¨è½¬æ¢</button>
            <button id="clear-btn" class="btn btn-secondary">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
            <button id="toggle-auto" class="btn btn-secondary">â¸ï¸ æš‚åœè‡ªåŠ¨æ›´æ–°</button>
        </div>

        <!-- çŠ¶æ€ä¿¡æ¯ -->
        <div class="status">
            <span id="last-updated">æœ€åæ›´æ–°: ä»æœª</span>
        </div>
    </div>

    <script>
        // Markdownç¼–è¾‘å™¨ç±»
        class MarkdownEditor {
            constructor() {
                this.markdownInput = document.getElementById('markdown-input');
                this.previewContent = document.getElementById('preview-content');
                this.convertBtn = document.getElementById('convert-btn');
                this.clearBtn = document.getElementById('clear-btn');
                this.toggleAutoBtn = document.getElementById('toggle-auto');
                this.fullscreenBtn = document.getElementById('fullscreen-btn');
                this.exitFullscreenBtn = document.getElementById('exit-fullscreen-btn');
                this.charCount = document.getElementById('char-count');
                this.autoUpdateStatus = document.getElementById('auto-update-status');
                this.lastUpdated = document.getElementById('last-updated');
                this.errorMessage = document.getElementById('error-message');
                
                // æ£€æŸ¥URLå‚æ•°
                this.isFullscreenMode = this.checkFullscreenMode();
                this.fileToLoad = this.getFileParam();
                
                // é…ç½®marked.js
                this.configureMarked();
                
                // åˆå§‹åŒ–ç¼–è¾‘å™¨
                this.init();
            }

            // é…ç½®marked.jsè§£æå™¨
            configureMarked() {
                try {
                    // æ£€æŸ¥marked.jsæ˜¯å¦åŠ è½½æˆåŠŸ
                    if (typeof marked === 'undefined') {
                        throw new Error('marked.jsåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                    }

                    // é…ç½®markedé€‰é¡¹
                    marked.setOptions({
                        highlight: function(code, lang) {
                            // ç®€å•çš„ä»£ç é«˜äº®ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨highlight.jsï¼‰
                            return `<pre><code class="language-${lang}">${code}</code></pre>`;
                        },
                        breaks: true,        // å¯ç”¨æ¢è¡Œç¬¦è½¬æ¢
                        gfm: true,           // å¯ç”¨GitHubé£æ ¼çš„Markdown
                        tables: true,        // å¯ç”¨è¡¨æ ¼æ”¯æŒ
                        sanitize: false      // ä¸æ¸…ç†HTMLï¼ˆå…è®¸ä½¿ç”¨HTMLæ ‡ç­¾ï¼‰
                    });

                    console.log('marked.jsé…ç½®æˆåŠŸ');
                } catch (error) {
                    this.showError('marked.jsé…ç½®å¤±è´¥: ' + error.message);
                }
            }

            // åˆå§‹åŒ–ç¼–è¾‘å™¨
            async init() {
                // å¦‚æœæœ‰æ–‡ä»¶å‚æ•°ï¼Œå…ˆåŠ è½½æ–‡ä»¶
                if (this.fileToLoad) {
                    await this.loadExternalFile();
                } else {
                    // è®¾ç½®é»˜è®¤å†…å®¹
                    this.setDefaultContent();
                }
                
                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                this.bindEvents();
                
                // åº”ç”¨å…¨å±æ¨¡å¼ï¼ˆå¦‚æœURLå‚æ•°æŒ‡å®šï¼‰
                if (this.isFullscreenMode) {
                    this.enterFullscreenMode();
                }
                
                // åˆå§‹æ¸²æŸ“
                this.renderPreview();
                
                // æ·»åŠ æ–‡ä»¶é€‰æ‹©å™¨ï¼ˆå¦‚æœæ²¡æœ‰æ–‡ä»¶å‚æ•°ï¼‰
                if (!this.fileToLoad) {
                    this.addFileSelector();
                }
                
                console.log('Markdownç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ');
            }

            // è®¾ç½®é»˜è®¤å†…å®¹
            setDefaultContent() {
                const defaultContent = `# Markdownå®æ—¶ç¼–è¾‘å™¨

æ¬¢è¿ä½¿ç”¨Markdownå®æ—¶ç¼–è¾‘å™¨ï¼åœ¨å·¦ä¾§è¾“å…¥Markdownæ–‡æœ¬ï¼Œå³ä¾§å°†å®æ—¶æ˜¾ç¤ºæ¸²æŸ“æ•ˆæœã€‚

## æ”¯æŒçš„åŠŸèƒ½

- âœ… æ ‡é¢˜ï¼ˆ1-6çº§ï¼‰
- âœ… åˆ—è¡¨ï¼ˆæœ‰åºå’Œæ— åºï¼‰
- âœ… **ç²—ä½“**å’Œ*æ–œä½“*
- âœ… [é“¾æ¥](https://example.com)
- âœ… ä»£ç å—å’Œè¡Œå†…ä»£ç 
- âœ… å¼•ç”¨å—
- âœ… è¡¨æ ¼
- âœ… æ°´å¹³çº¿

## ç¤ºä¾‹ä»£ç 

\`\`\`javascript
// JavaScriptä»£ç ç¤ºä¾‹
function helloWorld() {
    console.log('Hello, Markdown!');
    return true;
}
\`\`\`

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—çš„ç¤ºä¾‹ï¼Œç”¨äºçªå‡ºé‡è¦å†…å®¹ã€‚

## è¡¨æ ¼ç¤ºä¾‹

| åŠŸèƒ½ | æ”¯æŒ | å¤‡æ³¨ |
|------|------|------|
| æ ‡é¢˜ | âœ… | æ”¯æŒ1-6çº§æ ‡é¢˜ |
| åˆ—è¡¨ | âœ… | æ”¯æŒæœ‰åºå’Œæ— åºåˆ—è¡¨ |
| ä»£ç  | âœ… | æ”¯æŒè¯­æ³•é«˜äº® |

---

å¼€å§‹ç¼–å†™æ‚¨çš„Markdownæ–‡æ¡£å§ï¼`;
                
                this.markdownInput.value = defaultContent;
                this.updateCharCount();
            }

            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEvents() {
                // å®æ—¶è¾“å…¥ç›‘å¬
                this.markdownInput.addEventListener('input', () => {
                    this.updateCharCount();
                    if (this.autoUpdateEnabled) {
                        this.renderPreview();
                    }
                });

                // æ‰‹åŠ¨è½¬æ¢æŒ‰é’®
                this.convertBtn.addEventListener('click', () => {
                    this.renderPreview();
                });

                // æ¸…ç©ºå†…å®¹æŒ‰é’®
                this.clearBtn.addEventListener('click', () => {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                        this.markdownInput.value = '';
                        this.renderPreview();
                        this.updateCharCount();
                    }
                });

                // åˆ‡æ¢è‡ªåŠ¨æ›´æ–°æŒ‰é’®
                this.toggleAutoBtn.addEventListener('click', () => {
                    this.toggleAutoUpdate();
                });

                // å…¨å±é¢„è§ˆæŒ‰é’®
                this.fullscreenBtn.addEventListener('click', () => {
                    this.enterFullscreenMode();
                });

                // é€€å‡ºå…¨å±æŒ‰é’®
                this.exitFullscreenBtn.addEventListener('click', () => {
                    this.exitFullscreenMode();
                });

                // é”®ç›˜å¿«æ·é”®
                this.markdownInput.addEventListener('keydown', (e) => {
                    // Ctrl+Enter æ‰‹åŠ¨è½¬æ¢
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        this.renderPreview();
                    }
                    
                    // Ctrl+Shift+C æ¸…ç©ºå†…å®¹
                    if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                        e.preventDefault();
                        this.clearBtn.click();
                    }
                    
                    // Escape é€€å‡ºå…¨å±
                    if (e.key === 'Escape' && this.isFullscreenMode) {
                        e.preventDefault();
                        this.exitFullscreenMode();
                    }
                });

                // åˆå§‹å¯ç”¨è‡ªåŠ¨æ›´æ–°
                this.autoUpdateEnabled = true;
            }

            // æ¸²æŸ“é¢„è§ˆ
            renderPreview() {
                try {
                    const markdownText = this.markdownInput.value.trim();
                    
                    if (markdownText === '') {
                        this.previewContent.innerHTML = '<p style="color: #999; text-align: center; margin-top: 50%;">é¢„è§ˆå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>';
                        return;
                    }

                    // ä½¿ç”¨marked.jsè§£æMarkdown
                    const htmlContent = marked.parse(markdownText);
                    
                    // æ›´æ–°é¢„è§ˆå†…å®¹
                    this.previewContent.innerHTML = htmlContent;
                    
                    // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                    this.updateLastUpdated();
                    
                    // éšè—é”™è¯¯ä¿¡æ¯
                    this.hideError();
                    
                } catch (error) {
                    this.showError('Markdownè§£æå¤±è´¥: ' + error.message);
                    console.error('Markdownè§£æé”™è¯¯:', error);
                }
            }

            // åˆ‡æ¢è‡ªåŠ¨æ›´æ–°
            toggleAutoUpdate() {
                this.autoUpdateEnabled = !this.autoUpdateEnabled;
                
                if (this.autoUpdateEnabled) {
                    this.autoUpdateStatus.textContent = 'å¼€å¯';
                    this.toggleAutoBtn.textContent = 'â¸ï¸ æš‚åœè‡ªåŠ¨æ›´æ–°';
                    this.toggleAutoBtn.classList.remove('btn-secondary');
                    this.toggleAutoBtn.classList.add('btn-primary');
                    
                    // ç«‹å³æ¸²æŸ“å½“å‰å†…å®¹
                    this.renderPreview();
                } else {
                    this.autoUpdateStatus.textContent = 'å…³é—­';
                    this.toggleAutoBtn.textContent = 'â–¶ï¸ å¼€å¯è‡ªåŠ¨æ›´æ–°';
                    this.toggleAutoBtn.classList.remove('btn-primary');
                    this.toggleAutoBtn.classList.add('btn-secondary');
                }
            }

            // æ›´æ–°å­—ç¬¦è®¡æ•°
            updateCharCount() {
                const text = this.markdownInput.value;
                this.charCount.textContent = text.length;
            }

            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            updateLastUpdated() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                this.lastUpdated.textContent = `æœ€åæ›´æ–°: ${timeString}`;
            }

            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.style.display = 'block';
                
                // 5ç§’åè‡ªåŠ¨éšè—é”™è¯¯ä¿¡æ¯
                setTimeout(() => {
                    this.hideError();
                }, 5000);
            }

            // éšè—é”™è¯¯ä¿¡æ¯
            hideError() {
                this.errorMessage.style.display = 'none';
            }

            // æ£€æŸ¥URLå‚æ•°æ˜¯å¦åŒ…å«å…¨å±æ¨¡å¼
            checkFullscreenMode() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('show') === 'all';
            }

            // è¿›å…¥å…¨å±æ¨¡å¼
            enterFullscreenMode() {
                // æ·»åŠ å…¨å±æ¨¡å¼ç±»
                document.body.classList.add('fullscreen-mode');
                
                // åˆ‡æ¢æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
                this.fullscreenBtn.style.display = 'none';
                this.exitFullscreenBtn.style.display = 'inline-block';
                
                // æ›´æ–°çŠ¶æ€
                this.isFullscreenMode = true;
                
                // å¦‚æœURLä¸­è¿˜æ²¡æœ‰å‚æ•°ï¼Œåˆ™æ·»åŠ å‚æ•°å¹¶åˆ·æ–°
                if (!this.checkFullscreenMode()) {
                    const newUrl = this.addFullscreenParam(window.location.href);
                    window.history.replaceState({}, '', newUrl);
                }
                
                console.log('è¿›å…¥å…¨å±é¢„è§ˆæ¨¡å¼');
            }

            // é€€å‡ºå…¨å±æ¨¡å¼
            exitFullscreenMode() {
                // ç§»é™¤å…¨å±æ¨¡å¼ç±»
                document.body.classList.remove('fullscreen-mode');
                
                // åˆ‡æ¢æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
                this.fullscreenBtn.style.display = 'inline-block';
                this.exitFullscreenBtn.style.display = 'none';
                
                // æ›´æ–°çŠ¶æ€
                this.isFullscreenMode = false;
                
                // ç§»é™¤URLå‚æ•°å¹¶åˆ·æ–°
                const newUrl = this.removeFullscreenParam(window.location.href);
                window.history.replaceState({}, '', newUrl);
                
                console.log('é€€å‡ºå…¨å±é¢„è§ˆæ¨¡å¼');
            }

            // æ·»åŠ å…¨å±å‚æ•°åˆ°URL
            addFullscreenParam(url) {
                const urlObj = new URL(url);
                urlObj.searchParams.set('show', 'all');
                return urlObj.toString();
            }

            // ä»URLä¸­ç§»é™¤å…¨å±å‚æ•°
            removeFullscreenParam(url) {
                const urlObj = new URL(url);
                urlObj.searchParams.delete('show');
                return urlObj.toString();
            }

            // è·å–æ–‡ä»¶å‚æ•°
            getFileParam() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('file');
            }

            // åŠ è½½å¤–éƒ¨Markdownæ–‡ä»¶
            async loadExternalFile() {
                try {
                    if (!this.fileToLoad) {
                        return;
                    }

                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    this.showLoadingState();

                    // æ¸…ç†å’Œæ ‡å‡†åŒ–æ–‡ä»¶è·¯å¾„
                    let filePath = this.cleanFilePath(this.fileToLoad);
                    
                    console.log('åŸå§‹æ–‡ä»¶å‚æ•°:', this.fileToLoad);
                    console.log('å¤„ç†åæ–‡ä»¶è·¯å¾„:', filePath);

                    // ä½¿ç”¨fetch APIåŠ è½½æ–‡ä»¶
                    const response = await fetch(filePath);
                    
                    if (!response.ok) {
                        // å°è¯•å¤‡ç”¨è·¯å¾„
                        const alternativePath = this.getAlternativePath(filePath);
                        console.log('å°è¯•å¤‡ç”¨è·¯å¾„:', alternativePath);
                        
                        const altResponse = await fetch(alternativePath);
                        if (altResponse.ok) {
                            const content = await altResponse.text();
                            this.markdownInput.value = content;
                            this.updateCharCount();
                            this.updatePageTitle(alternativePath);
                            console.log('æ–‡ä»¶åŠ è½½æˆåŠŸï¼ˆå¤‡ç”¨è·¯å¾„ï¼‰:', alternativePath);
                            return;
                        }
                        
                        throw new Error(`æ–‡ä»¶åŠ è½½å¤±è´¥: ${response.status} ${response.statusText}`);
                    }

                    const content = await response.text();
                    
                    // æ›´æ–°ç¼–è¾‘å™¨å†…å®¹
                    this.markdownInput.value = content;
                    this.updateCharCount();
                    
                    // æ›´æ–°é¡µé¢æ ‡é¢˜æ˜¾ç¤ºå½“å‰æ–‡ä»¶å
                    this.updatePageTitle(filePath);
                    
                    console.log('æ–‡ä»¶åŠ è½½æˆåŠŸ:', filePath);
                    
                } catch (error) {
                    console.error('æ–‡ä»¶åŠ è½½å¤±è´¥:', error);
                    this.showError(`æ— æ³•åŠ è½½æ–‡ä»¶ "${this.fileToLoad}": ${error.message}`);
                    
                    // å›é€€åˆ°é»˜è®¤å†…å®¹
                    this.setDefaultContent();
                }
            }

            // æ¸…ç†æ–‡ä»¶è·¯å¾„
            cleanFilePath(filePath) {
                // è§£ç URLç¼–ç 
                let cleanedPath = decodeURIComponent(filePath);
                
                // æ›¿æ¢Windowsè·¯å¾„åˆ†éš”ç¬¦
                cleanedPath = cleanedPath.replace(/\\/g, '/');
                
                // ç§»é™¤å¼€å¤´çš„./æˆ–.\
                cleanedPath = cleanedPath.replace(/^\.\//, '');
                
                // å¦‚æœè·¯å¾„åŒ…å«article/article/ï¼Œç®€åŒ–ä¸ºarticle/
                cleanedPath = cleanedPath.replace(/article\/article\//g, 'article/');
                
                // ç¡®ä¿ä»¥æ­£ç¡®çš„è·¯å¾„å¼€å¤´
                if (!cleanedPath.startsWith('article/')) {
                    cleanedPath = 'article/' + cleanedPath;
                }
                
                // ç¡®ä¿ä»¥.mdç»“å°¾
                if (!cleanedPath.toLowerCase().endsWith('.md')) {
                    cleanedPath += '.md';
                }
                
                return cleanedPath;
            }

            // è·å–å¤‡ç”¨è·¯å¾„
            getAlternativePath(filePath) {
                // å¦‚æœè·¯å¾„å·²ç»æ˜¯article/article/ï¼Œå°è¯•ç›´æ¥article/
                if (filePath.includes('article/article/')) {
                    return filePath.replace('article/article/', 'article/');
                }
                
                // å¦‚æœè·¯å¾„æ˜¯article/ï¼Œå°è¯•article/article/
                if (filePath.startsWith('article/') && !filePath.includes('article/article/')) {
                    return filePath.replace('article/', 'article/article/');
                }
                
                return filePath;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoadingState() {
                this.markdownInput.value = `# æ­£åœ¨åŠ è½½æ–‡ä»¶...\n\næ–‡ä»¶è·¯å¾„: ${this.fileToLoad}\n\nè¯·ç¨å€™...`;
                this.previewContent.innerHTML = '<p style="color: #999; text-align: center; margin-top: 50%;">æ­£åœ¨åŠ è½½æ–‡ä»¶ï¼Œè¯·ç¨å€™...</p>';
            }

            // æ›´æ–°é¡µé¢æ ‡é¢˜
            updatePageTitle(filePath) {
                const fileName = filePath.split('/').pop().replace('.md', '');
                document.title = `${fileName} - Markdownç¼–è¾‘å™¨`;
                
                // æ›´æ–°ç¼–è¾‘å™¨å¤´éƒ¨æ˜¾ç¤ºæ–‡ä»¶å
                const headerTitle = document.querySelector('.editor-header h1');
                if (headerTitle) {
                    headerTitle.innerHTML = `ğŸ“ ${fileName} <small style="font-size: 0.6em; opacity: 0.8;">(Markdownç¼–è¾‘å™¨)</small>`;
                }
            }

            // æ·»åŠ æ–‡ä»¶é€‰æ‹©å™¨åˆ°ç•Œé¢
            addFileSelector() {
                // åœ¨ç¼–è¾‘å™¨å¤´éƒ¨æ·»åŠ æ–‡ä»¶é€‰æ‹©å™¨
                const editorHeader = document.querySelector('.editor-header');
                if (editorHeader && !document.getElementById('file-selector')) {
                    const fileSelector = document.createElement('div');
                    fileSelector.id = 'file-selector';
                    fileSelector.style.marginTop = '15px';
                    fileSelector.innerHTML = `
                        <div style="display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;">
                            <span style="color: rgba(255,255,255,0.9);">ğŸ“ å¿«é€Ÿæ‰“å¼€:</span>
                            <select id="file-dropdown" style="padding: 8px 12px; border-radius: 4px; border: none; background: white; color: #333;">
                                <option value="">é€‰æ‹©æ–‡ä»¶...</option>
                                <option value="ğŸ“š å››å·çœåŒæµä¸­å­¦ 2025-2026 å­¦å¹´ä¸ŠæœŸç¬¬ä¸€æ¬¡è´¨é‡ç›‘æµ‹">å››å·çœåŒæµä¸­å­¦è´¨é‡ç›‘æµ‹</option>
                            </select>
                            <button id="load-file-btn" style="padding: 8px 16px; border: none; border-radius: 4px; background: #3498db; color: white; cursor: pointer;">ğŸ“‚ æ‰“å¼€æ–‡ä»¶</button>
                            <span style="color: rgba(255,255,255,0.7); font-size: 0.9em;">æˆ–ç›´æ¥åœ¨URLä¸­æ·»åŠ  file=æ–‡ä»¶å.md</span>
                        </div>
                    `;
                    
                    editorHeader.appendChild(fileSelector);
                    
                    // ç»‘å®šäº‹ä»¶
                    this.bindFileSelectorEvents();
                }
            }

            // ç»‘å®šæ–‡ä»¶é€‰æ‹©å™¨äº‹ä»¶
            bindFileSelectorEvents() {
                const loadFileBtn = document.getElementById('load-file-btn');
                const fileDropdown = document.getElementById('file-dropdown');
                
                if (loadFileBtn && fileDropdown) {
                    loadFileBtn.addEventListener('click', () => {
                        const selectedFile = fileDropdown.value;
                        if (selectedFile) {
                            this.loadFileByUrl(selectedFile);
                        }
                    });
                    
                    fileDropdown.addEventListener('change', (e) => {
                        if (e.target.value) {
                            this.loadFileByUrl(e.target.value);
                        }
                    });
                }
            }

            // é€šè¿‡URLåŠ è½½æ–‡ä»¶
            loadFileByUrl(fileName) {
                const newUrl = this.addFileParam(window.location.href, fileName);
                window.location.href = newUrl;
            }

            // æ·»åŠ æ–‡ä»¶å‚æ•°åˆ°URL
            addFileParam(url, fileName) {
                const urlObj = new URL(url);
                urlObj.searchParams.set('file', fileName);
                return urlObj.toString();
            }

            // ä»URLä¸­ç§»é™¤æ–‡ä»¶å‚æ•°
            removeFileParam(url) {
                const urlObj = new URL(url);
                urlObj.searchParams.delete('file');
                return urlObj.toString();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç¼–è¾‘å™¨
        document.addEventListener('DOMContentLoaded', () => {
            try {
                window.markdownEditor = new MarkdownEditor();
            } catch (error) {
                console.error('ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥:', error);
                alert('ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        });

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            console.error('å…¨å±€é”™è¯¯:', event.error);
        });
    </script>
</body>
</html>